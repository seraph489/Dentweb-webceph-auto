# 🦷 WebCeph 자동화 프로그램 PRD (v2.0)

## 1. 제품 개요

### 1.1 제품명
**AutoCeph** (가칭)

### 1.2 제품 설명
AutoCeph는 치과 EMR 프로그램인 **덴트웹(Dentweb)**과 연동하여 환자 분석 프로세스를 자동화하는 **Windows 데스크톱 애플리케이션**입니다.  
덴트웹 화면에서 직접 환자 정보를 **OCR**로 추출하고, 환자 사진을 복사하여 **WebCeph**에 자동 등록 및 분석을 실행합니다.  
최종적으로 생성된 PDF 보고서를 **Make.com Webhook**으로 전송하여 반복적인 수작업을 최소화합니다.

### 1.3 비전
> "단순 반복적인 EMR 및 분석 작업을 자동화하여, 치과 의료진이 환자 진료의 본질에 더 집중할 수 있도록 돕는 스마트 워크플로우 솔루션"

## 2. 문제점 정의

| 문제점 | 상세 설명 | 영향도 |
|--------|-----------|--------|
| 화면 기반 정보 추출의 부재 | 덴트웹에 있는 환자 정보를 WebCeph에 옮기기 위해 수동으로 확인하고 타이핑해야 함 | 높음 |
| 반복적인 이미지 복사/붙여넣기 | 덴트웹의 환자 사진을 로컬에 저장 후 다시 업로드해야 함 | 높음 |
| 프로세스 간 시간 소모 | 환자당 평균 5~7분 소요 | 높음 |
| 휴먼 에러 발생 | 수동 입력 과정에서 오타, 잘못된 파일 선택 등 실수 발생 | 중간 |
| 결과물 공유의 비효율성 | PDF를 메신저나 이메일로 따로 전송 | 중간 |

## 3. 목표 및 KPI

### 3.1 주요 목표

- **효율성 극대화**: 환자당 전체 처리 시간을 7분 → 1분 이내 단축  
- **정확성 향상**: OCR과 자동화로 수동입력 오류 95% 이상 감소  
- **완전 자동화**: 전체 핵심 프로세스 90% 이상 자동화  

### 3.2 측정 가능한 KPI

| KPI 항목 | 현재 | 목표 | 측정 방법 |
|----------|------|------|------------|
| 환자당 평균 처리 시간 | 5~7분 | < 1분 | 프로그램 실행 로그 기반 |
| 자동 PDF 전송 성공률 | 0% | > 95% | Webhook 응답 코드 기반 |
| OCR 정확도 | N/A | > 98% | 원본 정보와 샘플 비교 |
| 수동 개입률 | 100% | < 10% | 수동 처리 횟수 기록 |

## 4. 기능 요구사항 (FR)

### 4.1 필수 기능 (Must Have)

#### 4.1.1 환자 정보 자동 추출 (OCR)
- **기능 설명**: 덴트웹 화면의 특정 영역을 스크린 캡쳐하여 Upstage OCR API로 정보 추출  
- **상세 요구사항**:
  - 지정된 좌표 캡쳐: `(예: 0,0,600,500)`
  - 추출 항목: 이름, 등록번호, 생년월일, 핸드폰 번호
  - Upstage API 키는 GUI에서 입력/저장 (`config.json`)

#### 4.1.2 덴트웹 사진 자동 복사
- **기능 설명**: pyautogui를 이용해 현재 환자의 구강내 및 X-ray 사진 자동 복사 후 저장  
- **상세 요구사항**:
  - `mouse_positions.json` 기반 마우스 동작
  - 이미지 저장 경로: `temp_images/{환자이름}/`

#### 4.1.3 WebCeph 자동 등록 및 분석
- **기능 설명**: selenium을 이용해 WebCeph 로그인 → 환자 등록 → 이미지 업로드 → 분석 실행  
- **상세 요구사항**:
  - GUI에서 WebCeph 로그인 정보 입력/저장
  - 신규 환자 등록 시 OCR 정보 자동 입력
  - 이미지 업로드 방식: HTML 업로드 또는 Drag & Drop
  - pyautogui로 분석 시작 및 PDF 다운로드
  - PDF 저장 형식: `Reports/{환자이름}_{등록번호}_{날짜}.pdf`

#### 4.1.4 PDF Webhook 전송
- **기능 설명**: "PDF 전송하기" 클릭 시, Make.com Webhook으로 PDF 전송  
- **상세 요구사항**:
  - `requests`를 이용한 `multipart/form-data` POST 전송
  - Webhook URL은 `config.json`에서 관리
  - 성공/실패 피드백 표시 (로그 또는 메시지 박스)

### 4.2 추가 기능 (Nice to Have)
- 각 단계의 **진행률 표시 (OCR → 분석 → 전송 등)**
- **실행 로그 뷰어** 제공
- 설정 초기화 (API, ID/PW, 마우스 좌표)
- 프로그램 종료 시 **임시 이미지 자동 삭제**

## 5. 기술 사양

### 5.1 개발 스택

| 구분 | 기술 | 선정 이유 |
|------|------|-----------|
| 주 언어 | Python 3.9+ | 자동화 라이브러리와 빠른 개발 속도 |
| GUI 프레임워크 | PyQt5 또는 Tkinter | 사용자 인터페이스 구성 |
| 화면 제어 | PyAutoGUI | 이미지 및 좌표 기반 자동 제어 |
| 웹 자동화 | Selenium | WebCeph 조작에 필수 |
| OCR | Upstage OCR API | 고정확도 외부 문자 인식 |
| HTTP 통신 | requests | Webhook 전송 |
| 이미지 처리 | Pillow (PIL) | 캡쳐 및 이미지 저장 |
| 패키징 | PyInstaller | .exe 파일 생성용 |

### 5.2 시스템 요구사항

- 운영체제: **Windows 10 / 11 (64bit)**
- 해상도: **1920x1080 권장**
- 덴트웹 버전: [테스트 완료된 버전 기입]
- 인터넷: 안정적인 연결 필수 (API, Webhook 용도)

## 6. 제약사항 및 리스크

| 구분 | 제약사항 및 리스크 | 대응 방안 |
|------|--------------------|-----------|
| UI 의존성 | 덴트웹/WebCeph UI 변경 시 자동화 실패 | `mouse_positions.json` 사용, 주기적 업데이트 |
| 해상도 의존성 | 다른 해상도에서는 좌표 오작동 가능 | 권장 해상도 명시, 이미지 인식 기반 클릭 고려 |
| API 서비스 의존성 | Upstage / Make.com 장애 시 작동 중단 | try-except 처리, 오류 알림 제공 |
| 보안 정책 | 병원 보안프로그램이 자동화 차단 가능성 | 관리자 권한 실행, 화이트리스트 등록 가이드 |
